<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地圖標註系統 - mobile-image-preview-fixed-20240927</title>
    
    <!-- PWA Support -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="地圖標註">
    <link rel="apple-touch-icon" href="./TG.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./TG.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./TG.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./TG.png">
    
    <!-- Meta tags for better mobile experience -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="地圖標註系統">
    <meta name="msapplication-TileColor" content="#2196F3">
    <meta name="msapplication-TileImage" content="./TG.png">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css?v=mobile-debug-version-20240927">
    <link rel="stylesheet" href="rotation.css">
    <link rel="stylesheet" href="path-color.css">
</head>
<body>
    <!-- 使用者/管理者入口按鈕 -->
    <button id="authBtn" class="floating-help-btn" title="登入/註冊" style="right: 60px; bottom: 20px;">👤</button>

    <!-- 地圖旋轉開關按鈕（置於 body，避免被地圖層覆蓋） -->
    <button id="rotateBtn" class="rotate-btn" title="地圖旋轉開關" onclick="toggleMapRotation()">
        <span id="rotateIcon">🔄</span>
    </button>


    <div class="container">
        <!-- 地圖容器 -->
        <div class="map-container">
            <div id="map"></div>
            
            <!-- 全螢幕按鈕 -->
            <button id="fullscreenBtn" class="fullscreen-btn" title="全螢幕顯示" onclick="handleFullscreenClick()">
                <span id="fullscreenIcon">⛶</span>
            </button>
            
            <!-- 定位點按鈕 -->
            <button id="locationBtn" class="location-btn" title="定位到我的位置" onclick="handleLocationClick()">
                <span id="locationIcon">📍</span>
            </button>
            
            <!-- 自動居中按鈕 -->
            <button id="centerBtn" class="center-btn" title="開啟/關閉自動居中功能" onclick="handleCenterClick()">
                <span id="centerIcon">🎯</span>
            </button>

            
            
            <!-- 可移動的設定按鈕 -->
            <button id="floatingSettingsBtn" class="floating-settings-btn" title="設定">
                <span>⚙️</span>
            </button>
            
            <!-- 可移動的幫助按鈕 -->
            <button id="floatingHelpBtn" class="floating-help-btn" title="功能說明" onclick="showHelpModal()">
                <span>?</span>
            </button>
            
            <!-- 浮動控制面板 -->
            <div class="floating-controls">
                <button id="addMarkerBtn" class="control-btn icon-only" title="標註模式">
                    <span>+</span>
                </button>
                <!-- 自動追蹤已自動啟動，移除螢幕上的提示按鈕 -->
                <button id="notificationBtn" class="control-btn icon-only" title="開啟/關閉通知">
                    <span>🔕</span>
                </button>
                <button id="drawRouteBtn" class="control-btn icon-only" title="手動繪製路線">
                    <span>✍️</span>
                </button>
            </div>
            
            <!-- 位置顯示區域 -->
            <div id="currentLocation" onclick="handleCurrentLocationClick()">定位中...</div>
            <div id="locationAccuracy" class="accuracy-display">精度: --</div>

        </div>
    </div>

    <!-- 使用者/管理者身份與分享面板 -->
    <div id="authModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 520px;">
            <span class="close">&times;</span>
            <h2>使用者入口</h2>
            <div class="tab-buttons" style="display:flex; gap:8px; margin-bottom:12px;">
                <button id="tabAdmin" class="secondary-btn">管理者</button>
            </div>

            <!-- 使用者登入已移除 -->

            <!-- 管理者面板：需登入後才可即時監看 -->
            <form id="adminForm" style="display:none;">
                <label for="adminEmail">管理者 Email</label>
                <input type="email" id="adminEmail" value="tzongbinn@gmail.com" required>
                <label for="adminPassword">管理者密碼</label>
                <input type="password" id="adminPassword" value="1a2b3c4d" required>
                <button type="submit" class="primary-btn" style="margin-top:8px;">登入管理者</button>
                <div id="adminResult" class="status-display" style="margin-top:6px;">尚未登入</div>
                <div id="adminLivePanel" style="display:none; margin-top:12px;">
                    <h3>目前使用者定位（即時）</h3>
                    <div id="adminLocationsList" class="markers-list" style="max-height:180px; overflow:auto;"></div>
                    <small>管理者登入後可於地圖與清單即時查看所有使用者最新位置。</small>
                </div>
            </form>
        </div>
    </div>

    <!-- 通知彈窗 -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>位置提醒</h2>
            <p id="notificationMessage"></p>
        </div>
    </div>

    <!-- 標註點詳情彈窗 -->
    <div id="markerModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>標註點詳情</h2>
            <form id="markerForm">
                    <label for="markerName">名稱:</label>
                    <input type="text" id="markerName" required>
                    
                    <label for="markerDescription">描述:</label>
                    <textarea id="markerDescription" rows="2"></textarea>
                    
                    <div class="image-upload-section">
                        <label for="markerImages">圖片 (最多6張):</label>
                        <div class="image-upload-container">
                            <input type="file" id="markerImages" accept="image/*" multiple style="display: none;">
                            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
                            <div class="upload-buttons">
                                <button type="button" id="uploadImageBtn" class="upload-btn">📁 選擇檔案</button>
                                <button type="button" id="cameraBtn" class="upload-btn camera-btn">📷 拍照</button>
                            </div>
                            <div id="imagePreviewContainer" class="image-preview-container">
                                <!-- 動態生成的圖片預覽將顯示在這裡 -->
                            </div>
                        </div>
                    </div>
                    
                    <label for="markerGroup">所屬組別:</label>
                    <select id="markerGroup"></select>
                    
                    <label for="markerSubgroup">所屬群組:</label>
                    <select id="markerSubgroup"></select>
                    
                    <div class="marker-customization">
                        <div class="customization-row">
                            <div class="customization-group">
                                <label for="markerColor">顏色:</label>
                                <div class="color-options">
                                    <input type="radio" id="color-red" name="markerColor" value="red" checked>
                                    <label for="color-red" class="color-option red"></label>
                                    
                                    <input type="radio" id="color-blue" name="markerColor" value="blue">
                                    <label for="color-blue" class="color-option blue"></label>
                                    
                                    <input type="radio" id="color-green" name="markerColor" value="green">
                                    <label for="color-green" class="color-option green"></label>
                                    
                                    <input type="radio" id="color-orange" name="markerColor" value="orange">
                                    <label for="color-orange" class="color-option orange"></label>
                                </div>
                            </div>
                            
                            <div class="customization-group">
                                <label for="markerIcon">圖案:</label>
                                <div class="icon-options">
                                    <input type="radio" id="icon-default" name="markerIcon" value="📍" checked>
                                    <label for="icon-default" class="icon-option">📍</label>
                                    
                                    <input type="radio" id="icon-speaker" name="markerIcon" value="📢">
                                    <label for="icon-speaker" class="icon-option">📢</label>
                                    
                                    <input type="radio" id="icon-phone" name="markerIcon" value="📞">
                                    <label for="icon-phone" class="icon-option">📞</label>
                                    
                                    <input type="radio" id="icon-radio" name="markerIcon" value="📻">
                                    <label for="icon-radio" class="icon-option">📻</label>
                                    
                                    <input type="radio" id="icon-tb" name="markerIcon" value="TB">
                                    <label for="icon-tb" class="icon-option">TB</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-buttons">
                        <button type="submit">保存</button>
                        <button type="button" id="deleteMarkerBtn">刪除</button>
                        <button type="button" class="cancel">取消</button>
                    </div>
                </form>
        </div>
    </div>

    <!-- 初始設定彈窗 -->
    <div id="initialSetupModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>🎯 歡迎使用地圖標註系統</h2>
            <div class="setup-content">
                <div class="setup-section">
                    <h3>選擇預設組別</h3>
                    <p>選擇一個組別作為開始使用的預設組別，您可以隨時在左側面板切換。</p>
                    <select id="defaultGroupSelect">
                        <option value="">不選擇預設組別</option>
                    </select>
                    <button id="createFirstGroupBtn" class="secondary-btn">建立第一個組別</button>
                </div>
                
                <div class="setup-section">
                    <h3>提醒設定</h3>
                    <div class="setup-grid">
                        <div class="setup-item">
                            <label for="setupAlertDistance">提醒距離 (公尺):</label>
                            <input type="number" id="setupAlertDistance" value="100" min="10" max="1000">
                        </div>
                        <div class="setup-item">
                            <label for="setupAlertInterval">提醒間隔 (秒):</label>
                            <input type="number" id="setupAlertInterval" value="30" min="5" max="300">
                        </div>
                    </div>
                </div>
                
                <div class="setup-section">
                    <h3>權限設定</h3>
                    <p>為了提供完整的位置提醒功能，我們需要以下權限：</p>
                    <label class="checkbox-label">
                        <input type="checkbox" id="setupEnableLocation" checked>
                        📍 啟用位置追蹤
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="setupEnableNotifications">
                        🔔 啟用通知提醒 (建議手機用戶開啟)
                    </label>
                    <div class="permission-note">
                        <small>💡 手機用戶建議同時開啟兩項權限以獲得最佳體驗</small>
                    </div>
                </div>
            </div>
            
            <div class="setup-buttons">
                <button id="startUsingBtn" class="primary-btn">開始使用</button>
                <button id="skipSetupBtn" class="secondary-btn">跳過設定</button>
            </div>
        </div>
    </div>

    <!-- 建立組別彈窗 -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>建立新組別</h2>
            <form id="createGroupForm">
                <label for="newGroupName">組別名稱:</label>
                <input type="text" id="newGroupName" placeholder="例如：工作地點、休閒場所" required>
                
                <label for="newGroupDescription">組別描述 (可選):</label>
                <textarea id="newGroupDescription" rows="2" placeholder="描述這個組別的用途"></textarea>
                
                <div class="form-buttons">
                    <button type="submit">建立組別</button>
                    <button type="button" class="cancel">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 圖片預覽模態框 -->
    <div id="imagePreviewModal" class="modal image-modal">
        <div class="modal-content image-modal-content">
            <span class="close image-modal-close">&times;</span>
            <div class="image-modal-header">
                <h3 id="imageModalTitle">圖片預覽</h3>
                <div class="image-navigation">
                    <span id="imageCounter">1 / 1</span>
                </div>
            </div>
            <div class="image-modal-body">
                <button id="prevImageBtn" class="nav-btn">‹</button>
                <button id="nextImageBtn" class="nav-btn">›</button>
                <img id="modalPreviewImg" src="" alt="預覽圖片">
                <div id="imageThumbnailContainer" class="image-thumbnail-container">
                    <!-- 縮圖將動態生成在這裡 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 組別/群組詳情浮動視窗 -->
    <div id="groupDetailsModal" class="modal">
        <div class="modal-content group-detail-content">
            <span class="close">&times;</span>
            <div class="group-detail-header">
                <h2 id="groupDetailsTitle">組別詳情</h2>
                <div id="groupDetailsStats" class="group-detail-stats">
                    <span id="groupMarkerCount">0 個標註點</span>
                </div>
            </div>
            <div class="group-detail-body">
                <div class="group-detail-actions">
                    <button id="showAllGroupMarkersBtn" class="detail-action-btn">
                        <span>👁️</span>
                        顯示所有標註點
                    </button>
                    <button id="hideAllGroupMarkersBtn" class="detail-action-btn">
                        <span>🙈</span>
                        隱藏所有標註點
                    </button>
                    <button id="centerToGroupBtn" class="detail-action-btn">
                        <span>🎯</span>
                        居中顯示
                    </button>
                </div>
                <div class="group-markers-list">
                    <h4>標註點列表</h4>
                    <div id="groupDetailsMarkersList" class="detail-markers-container">
                        <!-- 動態生成的標註點列表 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 全部組別群組詳情浮動視窗 -->
    <div id="allDetailsModal" class="modal">
        <div class="modal-content all-details-content">
            <span class="close">&times;</span>
            <div class="all-details-header">
                <h2>📋 所有組別及群組詳情</h2>
                <div class="all-details-stats">
                    <span id="totalGroupsCount">0 個組別</span>
                    <span id="totalMarkersCount">0 個標註點</span>
                </div>
            </div>
            <div class="all-details-body">
                <div id="allDetailsContent" class="all-details-container">
                    <!-- 動態生成的所有組別群組內容 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 匯入選項模態框 -->
    <div id="importOptionsModal" class="modal">
        <div class="modal-content import-options-content">
            <span class="close">&times;</span>
            <h2>匯入標註點選項</h2>
            <div class="import-options-body">
                <div id="comparisonInfo" class="import-comparison-info">
                    <h3>檢測到重複的標註點</h3>
                    <p>系統發現匯入的資料中有 <span id="duplicateCount">0</span> 個標註點與現有資料重複。</p>
                    <p>新增的標註點有 <span id="newCount">0</span> 個。</p>
                </div>
                
                <div class="import-options">
                    <div class="import-option">
                        <input type="radio" id="importMerge" name="importMode" value="merge" checked>
                        <label for="importMerge">
                            <div class="option-header">
                                <span class="option-icon">➕</span>
                                <span class="option-title">合併匯入</span>
                            </div>
                            <div class="option-description">
                                保留現有標註點，只添加新的標註點（跳過重複的）
                            </div>
                        </label>
                    </div>
                    
                    <div class="import-option">
                        <input type="radio" id="importUpdate" name="importMode" value="update">
                        <label for="importUpdate">
                            <div class="option-header">
                                <span class="option-icon">🔄</span>
                                <span class="option-title">更新合併</span>
                            </div>
                            <div class="option-description">
                                保留現有標註點，添加新的標註點，並更新重複標註點的資訊
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="duplicate-details" id="duplicateDetails" style="display: none;">
                    <h4>重複的標註點詳情</h4>
                    <div id="duplicateList" class="duplicate-list">
                        <!-- 動態生成的重複標註點列表 -->
                    </div>
                </div>
            </div>
            
            <div class="import-options-buttons">
                <button id="confirmImportBtn" class="primary-btn">確認匯入</button>
                <button id="cancelImportBtn" class="secondary-btn">取消</button>
                <button id="showDuplicatesBtn" class="detail-btn">查看重複詳情</button>
            </div>
        </div>
    </div>

    <!-- 浮動設定視窗 -->
    <div id="floatingSettingsModal" class="floating-settings-modal" style="display: none;">
        <div class="floating-settings-content">
            <div class="floating-settings-header">
                <h3>⚙️ 設定</h3>
                <button id="closeFloatingSettings" class="close-settings-btn">&times;</button>
            </div>
            <div class="floating-settings-body">

                
                <!-- 快速操作區域 -->
                <div class="setting-group">
                    <h4>🚀 快速操作</h4>
                    <div class="quick-actions-grid">
                        <button id="centerMapBtn" class="quick-action-btn" title="回到當前位置">
                            <span>📍</span>
                            <span>定位</span>
                        </button>

                        <button id="showAllMarkersBtn" class="quick-action-btn" title="顯示所有標記">
                            <span>👁️</span>
                            <span>顯示全部</span>
                        </button>
                        <button id="showAllDetailsBtn" class="quick-action-btn" title="顯示所有組別及群組詳情">
                            <span>📋</span>
                            <span>詳情</span>
                        </button>
                    </div>
                </div>

                <!-- 搜尋標註點 -->
                <div class="setting-group">
                    <h4>🔍 搜尋標註點</h4>
                    <div class="search-container">
                        <input type="text" id="markerSearchInput" placeholder="輸入標註點名稱或描述..." class="search-input">
                        <button id="clearSearchBtn" class="clear-search-btn" title="清除搜尋">×</button>
                    </div>
                    <div id="searchResults" class="search-results" style="display: none;">
                        <!-- 搜尋結果將動態顯示在這裡 -->
                    </div>
                </div>

                <!-- 組別管理 -->
                <div class="setting-group">
                    <h4>📁 組別管理</h4>
                    <div class="group-management">
                        <div class="group-input-row">
                            <input type="text" id="groupNameInput" placeholder="新組別名稱" class="compact-input">
                            <button id="addGroupBtn" class="add-group-btn">+</button>
                        </div>
                        <div id="groupsList" class="groups-list"></div>
                    </div>
                </div>

                <!-- 標註點列表 -->
                <div class="setting-group">
                    <h4>📍 標註點列表</h4>
                    <div id="markersList" class="markers-list"></div>
                </div>

                <!-- 位置提醒設定 -->
                <div class="setting-group">
                    <h4>🔔 位置提醒設定</h4>
                    <div class="setting-row">
                        <label class="switch">
                            <input type="checkbox" id="floatingEnableNotifications">
                            <span class="slider"></span>
                        </label>
                        <span>位置提醒</span>
                    </div>
                    <div class="setting-row">
                        <label>距離</label>
                        <input type="number" id="floatingAlertDistance" value="100" min="10" max="1000" class="compact-input">
                        <span class="unit">m</span>
                    </div>
                    <div class="setting-row">
                        <label>間隔</label>
                        <input type="number" id="floatingAlertInterval" value="30" min="5" max="300" class="compact-input">
                        <span class="unit">s</span>
                    </div>
                    <div class="setting-row">
                        <label class="switch">
                            <input type="checkbox" id="floatingEnableNotificationSound" checked>
                            <span class="slider"></span>
                        </label>
                        <span>通知音效</span>
                    </div>
                    <div class="setting-row">
                        <label>音量</label>
                        <input type="range" id="floatingNotificationVolume" min="0" max="100" value="50" class="volume-slider">
                        <span class="volume-value">50%</span>
                    </div>
                </div>
                
                <!-- 即時定位設定 -->
                <div class="setting-group">
                    <h4>📍 即時定位設定</h4>
                    <div class="setting-row">
                        <label class="switch">
                            <input type="checkbox" id="floatingEnableHighAccuracy" checked>
                            <span class="slider"></span>
                        </label>
                        <span>高精度模式</span>
                    </div>
                    <div class="setting-row">
                        <label class="switch">
                            <input type="checkbox" id="floatingAutoStartTracking">
                            <span class="slider"></span>
                        </label>
                        <span>自動開啟追蹤</span>
                    </div>
                    <div class="setting-row">
                        <label class="switch">
                            <input type="checkbox" id="floatingKeepMapCentered">
                            <span class="slider"></span>
                        </label>
                        <span>保持地圖中央</span>
                    </div>
                    
                    <!-- 路徑顏色設定 -->
                    <div class="setting-row">
                        <label>路徑顏色</label>
                        <div class="path-color-options">
                            <input type="radio" id="path-color-random" name="pathColor" value="random" checked>
                            <label for="path-color-random" class="path-color-option random">隨機</label>
                            
                            <input type="radio" id="path-color-red" name="pathColor" value="#FF1744">
                            <label for="path-color-red" class="path-color-option" style="background-color: #FF1744;"></label>
                            
                            <input type="radio" id="path-color-blue" name="pathColor" value="#2962FF">
                            <label for="path-color-blue" class="path-color-option" style="background-color: #2962FF;"></label>
                            
                            <input type="radio" id="path-color-green" name="pathColor" value="#00C853">
                            <label for="path-color-green" class="path-color-option" style="background-color: #00C853;"></label>
                            
                            <input type="radio" id="path-color-purple" name="pathColor" value="#7B1FA2">
                            <label for="path-color-purple" class="path-color-option" style="background-color: #7B1FA2;"></label>
                            
                            <input type="radio" id="path-color-orange" name="pathColor" value="#FF6D00">
                            <label for="path-color-orange" class="path-color-option" style="background-color: #FF6D00;"></label>
                        </div>
                    </div>

                    <div class="setting-row">
                        <label>更新頻率</label>
                        <select id="floatingLocationUpdateFrequency" class="compact-input">
                            <option value="200">超高速 (0.2秒)</option>
                            <option value="500">高速 (0.5秒)</option>
                            <option value="1000">即時 (1秒)</option>
                            <option value="2000">快速 (2秒)</option>
                            <option value="3000" selected>標準 (3秒)</option>
                            <option value="5000">省電 (5秒)</option>
                            <option value="10000">低耗電 (10秒)</option>
                            <option value="30000">超省電 (30秒)</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>定位超時</label>
                        <input type="number" id="floatingLocationTimeout" value="20" min="5" max="60" class="compact-input">
                        <span class="unit">s</span>
                    </div>
                </div>
                
                <div class="location-display">
                    <div id="floatingCurrentLocation" onclick="handleCurrentLocationClick()" style="cursor: pointer; user-select: none;">定位中...</div>
                    <div id="floatingLocationAccuracy" class="accuracy-display">精度: --</div>
                    <div id="floatingLocationStatus" class="status-display">狀態: 未啟動</div>
                    <div id="floatingLocationSpeed" class="speed-display" style="display: none;">速度: --</div>
                </div>
                
                <!-- 設定管理按鈕 -->
                <div class="settings-actions">
                    <button id="floatingSaveSettingsBtn" class="settings-btn save-btn">
                        <span>💾</span>
                        儲存目前設定
                    </button>
                    <button id="floatingLoadSettingsBtn" class="settings-btn load-btn">
                        <span>📂</span>
                        載入已儲存設定
                    </button>
                    <button id="floatingResetSettingsBtn" class="settings-btn reset-btn">
                        <span>🔄</span>
                        重置為預設值
                    </button>
                </div>
                
                <!-- 資料匯出匯入按鈕 -->
                <div class="data-actions">
                    <button id="floatingExportDataBtn" class="settings-btn export-btn">
                        <span>📤</span>
                        匯出全部紀錄（壓縮）
                    </button>
                    <button id="floatingImportDataBtn" class="settings-btn import-btn">
                        <span>📥</span>
                        匯入標註點
                    </button>
                    <input type="file" id="floatingImportFileInput" accept=".json,.gz,application/json,application/gzip" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <!-- 功能說明浮動視窗 -->
    <div id="helpModal" class="help-modal hidden" style="display: none;">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2>🎯 地圖標註系統功能說明</h2>
                <button id="closeHelpModal" class="close-help-btn">&times;</button>
            </div>
            <div class="help-modal-body">
                <div class="help-section">
                    <h3>📍 地圖與定位</h3>
                    <div class="help-item">
                        <span class="help-icon">🗺️</span>
                        <div class="help-text">
                            <strong>地圖顯示：</strong>使用 OpenStreetMap 提供詳細地圖資訊
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">📍</span>
                        <div class="help-text">
                            <strong>定位功能：</strong>點擊定位按鈕可快速定位到您的當前位置
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🎯</span>
                        <div class="help-text">
                            <strong>自動居中：</strong>開啟後地圖會自動跟隨您的位置移動
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>📌 標註點管理</h3>
                    <div class="help-item">
                        <span class="help-icon">➕</span>
                        <div class="help-text">
                            <strong>新增標註：</strong>點擊地圖任意位置即可新增標註點
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">✏️</span>
                        <div class="help-text">
                            <strong>編輯標註：</strong>點擊標註點可編輯名稱、描述和組別
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🗑️</span>
                        <div class="help-text">
                            <strong>刪除標註：</strong>在編輯視窗中可刪除不需要的標註點
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>👥 組別與群組管理</h3>
                    <div class="help-item">
                        <span class="help-icon">🏷️</span>
                        <div class="help-text">
                            <strong>組別分類：</strong>可為標註點設定不同組別，便於管理
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🎨</span>
                        <div class="help-text">
                            <strong>顏色區分：</strong>不同組別使用不同顏色標記，一目了然
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">👁️</span>
                        <div class="help-text">
                            <strong>顯示控制：</strong>可選擇顯示或隱藏特定組別的標註點
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>🔔 智能提醒系統</h3>
                    <div class="help-item">
                        <span class="help-icon">📍</span>
                        <div class="help-text">
                            <strong>位置提醒：</strong>當接近標註點時自動發送通知提醒
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">📏</span>
                        <div class="help-text">
                            <strong>距離設定：</strong>可自訂提醒距離範圍（10-1000公尺）
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🔊</span>
                        <div class="help-text">
                            <strong>音效提醒：</strong>支援聲音通知，確保不會錯過重要提醒
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>💾 資料管理</h3>
                    <div class="help-item">
                        <span class="help-icon">📤</span>
                        <div class="help-text">
                            <strong>匯出資料：</strong>可將所有標註點匯出為 JSON 檔案備份
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">📥</span>
                        <div class="help-text">
                            <strong>匯入資料：</strong>可匯入之前備份的標註點資料
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🔄</span>
                        <div class="help-text">
                            <strong>自動儲存：</strong>所有操作都會自動儲存到本地儲存空間
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>🧭 路線錄製與使用</h3>
                    <div class="help-item">
                        <span class="help-icon">⏺️</span>
                        <div class="help-text">
                            <strong>錄製路徑：</strong>在標註點彈窗點選「新增路線記錄」，系統會從目前位置開始記錄到目標的移動路徑，完成後將以距離與時間保存為該標註的路線記錄。
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🧾</span>
                        <div class="help-text">
                            <strong>選擇與操作：</strong>有多條記錄時，使用「選擇路線」下拉挑選，並透過下方按鈕「顯示」「隱藏」「使用」「刪除」管理；「全部隱藏」可一鍵移除地圖上已顯示的路線。
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">📍</span>
                        <div class="help-text">
                            <strong>使用路線：</strong>點選「使用」會將所選路線設為導引目標，後續可搭配追蹤與距離提示功能協助導航。
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">📱</span>
                        <div class="help-text">
                            <strong>手機選擇體驗：</strong>手機模式下，路線下拉在點選時會展開，於選定後自動收合，方便先選擇再操作。
                        </div>
                    </div>
                </div>

                <!-- 新增：手繪路線說明 -->
                <div class="help-section">
                    <h3>✍️ 手繪路線</h3>
                    <div class="help-item">
                        <span class="help-icon">✍️</span>
                        <div class="help-text">
                            <strong>開始手繪：</strong>點擊右上角手繪圖示開始；在地圖上按住拖曳即可描畫路線，放開可斷筆。
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">⏸️</span>
                        <div class="help-text">
                            <strong>暫停/繼續：</strong>使用左上角的「⏸️ 暫停繪製」可以暫停手繪，以便移動畫面；再次點擊變為「▶️ 繼續繪製」。
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">↩️</span>
                        <div class="help-text">
                            <strong>撤銷操作：</strong>提供「撤銷最後點」與「撤銷上一段」兩種修正方式。
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">🗑️</span>
                        <div class="help-text">
                            <strong>清除暫時路線：</strong>可一鍵清除目前尚未保存的手繪線段。
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>⚡ 快速操作指南</h3>
                    <div class="help-item">
                        <span class="help-icon">🔍</span>
                        <div class="help-text">
                            <strong>搜尋功能：</strong>在設定面板中可快速搜尋標註點
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">⛶</span>
                        <div class="help-text">
                            <strong>全螢幕模式：</strong>點擊全螢幕按鈕獲得更好的地圖檢視體驗
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">⚙️</span>
                        <div class="help-text">
                            <strong>設定面板：</strong>拖拽設定按鈕可調整面板位置
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- 通知音效腳本 -->
    <script src="notification-sound.js"></script>
    
    <!-- Android 整合腳本 -->
    <script src="android-integration.js"></script>
    
    <!-- 壓縮/解壓縮庫（pako） -->
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- 認證與分享邏輯 -->
    <script src="auth.js"></script>
    
    <script src="script.js?v=mobile-debug-version-20240927"></script>
    <script src="rotation.js"></script>
    

</body>
</html>