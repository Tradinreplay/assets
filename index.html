<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>資產辨識與管理</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="250924001600.png" type="image/png" />
  <link rel="apple-touch-icon" sizes="192x192" href="250924001600.png" />
  <meta name="theme-color" content="#1f6feb" />
  <!-- Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v4.0.2/dist/tesseract.min.js"></script>
  <!-- SheetJS for Excel export & import -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <h1>資產辨識與管理</h1>
    <p>拍照或載入圖片，辨識數字並建立資產紀錄。</p>
    <button id="installBtn" class="install-btn" title="安裝至主頁">安裝至主頁</button>
  </header>

  <main>
    <section class="card">
      <h2>影像來源</h2>
      <div class="controls">
        <button id="openCameraBtn">開啟相機</button>
        <button id="captureBtn" disabled>拍照</button>
        <label class="file-label">
          載入圖片<input type="file" id="imageInput" accept="image/*" />
        </label>
      </div>
      <div class="preview">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" width="640" height="480"></canvas>
      </div>
      <div id="status" class="status">狀態：就緒</div>
    </section>

    <section class="card">
      <h2>辨識結果與表格</h2>
      <form id="assetForm">
        <div class="grid">
          <label>
            資產編號
            <input type="text" id="assetNumber" placeholder="自動填入，可手動修正" />
          </label>
          <label>
            設備名稱
            <input type="text" id="deviceName" placeholder="請輸入設備名稱" />
          </label>
          <label>
            機身編號
            <input type="text" id="serialNumber" placeholder="請輸入機身編號" />
          </label>
          <label>
            單位
            <input type="text" id="unit" placeholder="請輸入單位" />
          </label>
          <label class="inline">
            <input type="checkbox" id="isManaged" /> 是否列管資產
          </label>
          <label>
            掃描日期時間
            <input type="text" id="scanDateTime" readonly />
          </label>
          <label class="inline">
            <input type="checkbox" id="isScrapped" /> 是否完成報廢
          </label>
        </div>
        <div class="form-actions">
          <button type="submit" id="saveBtn">保存紀錄</button>
          <button type="button" id="resetBtn">清除表單</button>
          <input type="hidden" id="editingId" />
        </div>
      </form>
    </section>

    <section class="card">
      <h2>紀錄查詢與匯出</h2>
      <div class="controls">
        <input type="text" id="searchInput" placeholder="關鍵字（資產編號或單位）" />
        <input type="date" id="startDateFilter" />
        <input type="date" id="endDateFilter" />
        <input type="text" id="unitFilter" placeholder="單位過濾" />
        <select id="isScrappedFilter">
          <option value="">報廢（全部）</option>
          <option value="true">是</option>
          <option value="false">否</option>
        </select>
        <select id="isManagedFilter">
          <option value="">列管（全部）</option>
          <option value="true">是</option>
          <option value="false">否</option>
        </select>
        <button id="exportBtn">匯出Excel</button>
        <input type="file" id="importExcel" accept=".xlsx,.xls,.csv" />
        <label class="inline"><input type="radio" name="importMode" value="merge" checked /> 合併匯入</label>
        <label class="inline"><input type="radio" name="importMode" value="update" /> 更新匯入</label>
        <button id="importBtn">匯入</button>
      </div>
      <table id="recordsTable">
        <thead>
          <tr>
            <th>資產編號</th>
            <th>設備名稱</th>
            <th>機身編號</th>
            <th>單位</th>
            <th>列管資產</th>
            <th>掃描日期時間</th>
            <th>完成報廢</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <footer>
    <small>資料儲存於瀏覽器本機(LocalStorage)。</small>
  </footer>

  <script src="script.js"></script>
</body>
</html>